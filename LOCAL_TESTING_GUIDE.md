# 🧪 本地测试完整指南

## 🚀 快速开始

### 1. 环境检查
```bash
# 检查 Node.js 版本（需要 >= 18）
node --version

# 检查 npm 版本
npm --version
```

### 2. 安装依赖
```bash
# 在项目根目录执行
npm install
```

### 3. 启动开发服务器
```bash
# 启动开发服务器（端口 5000）
npm run dev
```

### 4. 访问应用
打开浏览器访问：`http://localhost:5000`

## 🧪 测试场景

### 场景 1: 基础功能测试

#### 1.1 邮箱生成测试
1. 打开应用主页
2. 观察右侧卡片中的邮箱生成过程
3. **验证点**：
   - ✅ 邮箱格式：`[随机字符]@[固定域名]`
   - ✅ 域名来源：139.run, vod365.com, pda315.com, eattea.uk, 10086hy.com, kelianbao.com
   - ✅ 用户名长度：5-8位随机字符
   - ✅ 生成速度：应该比较快

#### 1.2 服务切换测试
1. 在页面顶部找到"邮箱服务配置"面板
2. 观察当前状态（默认应该是"优化版"）
3. 点击切换开关，切换到"标准版"
4. 再次切换回"优化版"
5. **验证点**：
   - ✅ 切换功能正常
   - ✅ 显示不同的徽章（优化版=绿色，标准版=蓝色）
   - ✅ 域名池显示（优化版显示6个固定域名）

### 场景 2: 性能对比测试

#### 2.1 浏览器内测试
1. 点击"性能对比"按钮
2. 观察性能对比弹窗
3. **验证点**：
   - ✅ 显示优化版 vs 标准版的对比数据
   - ✅ 优化版应该显示更快的速度
   - ✅ 网络请求次数：优化版2次 vs 标准版3次

#### 2.2 命令行性能测试
```bash
# 运行邮箱服务性能测试
npm run test:mail

# 查看固定域名池
npm run test:domains
```

**预期输出示例**：
```
📊 开始邮箱服务性能对比测试

🚀 测试优化版邮箱服务...
  📧 生成邮箱: abc123@139.run
  ⚡ 本地生成耗时: 1ms
  ✅ 账户创建成功，耗时: 800ms
  🔑 登录成功，耗时: 400ms

🔄 测试标准版邮箱服务...
  🌐 获取域名成功，耗时: 600ms
  📋 可用域名数量: 15
  📧 生成邮箱: xyz789@guerrillamail.com
  ✅ 账户创建成功，耗时: 850ms
  🔑 登录成功，耗时: 450ms

📈 性能对比结果:
🚀 优化版总耗时: 1201ms
🔄 标准版总耗时: 1900ms
📊 性能提升: 37%
```

### 场景 3: 邮件接收测试

#### 3.1 邮箱功能验证
1. 等待邮箱生成完成
2. 点击顶部的"收信箱"按钮
3. 观察邮箱状态显示为"在线"
4. **验证点**：
   - ✅ 邮箱地址正确显示
   - ✅ 状态显示为"在线"
   - ✅ 邮件列表界面正常

#### 3.2 实际邮件测试（可选）
1. 复制生成的邮箱地址
2. 使用其他邮箱服务发送测试邮件
3. 观察是否能实时接收到邮件
4. **验证点**：
   - ✅ 能够接收外部邮件
   - ✅ 实时通知功能正常
   - ✅ 邮件内容显示正确

## 🔍 调试技巧

### 1. 浏览器开发者工具
```javascript
// 在浏览器控制台中执行，查看当前邮箱服务状态
console.log('当前邮箱:', document.querySelector('[data-testid="temp-email"]')?.textContent);

// 查看网络请求
// 打开 Network 标签，观察邮箱创建过程中的网络请求
```

### 2. 日志监控
在浏览器控制台中查看：
- ✅ `🚀 开始创建优化邮箱账户...`
- ✅ `✅ 邮箱账户创建成功: xxx@xxx.com`
- ✅ `✅ 邮箱登录成功`
- ✅ `🔗 邮件事件监听已启动`

### 3. 错误排查
常见问题及解决方案：

#### 问题1: 邮箱创建失败
```
❌ 邮箱账户创建失败: 422 Unprocessable Entity
```
**解决方案**：
- 检查域名是否有效
- 尝试切换到标准版
- 检查网络连接

#### 问题2: 性能测试失败
```
❌ 测试过程中出现错误
```
**解决方案**：
- 检查网络连接
- 确认 Mail.tm API 服务正常
- 重新运行测试

#### 问题3: 切换服务无效果
**解决方案**：
- 刷新页面
- 清除浏览器缓存
- 检查控制台错误信息

## 📊 性能基准

### 预期性能指标：

| 指标 | 优化版 | 标准版 | 目标提升 |
|------|--------|--------|----------|
| 域名获取 | 0ms | 400-800ms | 100% |
| 总创建时间 | 1000-1500ms | 1800-2500ms | 30-50% |
| 网络请求 | 2次 | 3次 | 33% |
| 成功率 | >95% | >90% | 提升稳定性 |

### 测试环境要求：
- ✅ 稳定的网络连接
- ✅ 现代浏览器（Chrome/Firefox/Safari）
- ✅ Node.js >= 18
- ✅ 无代理或VPN干扰

## 🎯 验收标准

### 功能验收：
- ✅ 邮箱生成成功率 > 95%
- ✅ 域名来自固定池（优化版）
- ✅ 服务切换功能正常
- ✅ 性能对比数据准确

### 性能验收：
- ✅ 优化版比标准版快 30% 以上
- ✅ 网络请求减少至少 1 次
- ✅ 域名获取时间为 0（优化版）

### 用户体验验收：
- ✅ 界面响应流畅
- ✅ 错误处理友好
- ✅ 状态反馈及时
- ✅ 配置选项清晰

## 🚀 高级测试

### 压力测试：
```bash
# 连续创建10个邮箱测试稳定性
for i in {1..10}; do
  echo "测试第 $i 次..."
  npm run test:mail
  sleep 2
done
```

### 并发测试：
```javascript
// 在浏览器控制台中执行
async function concurrentTest() {
  const promises = [];
  for (let i = 0; i < 5; i++) {
    promises.push(fetch('/api/create-mail'));
  }
  const results = await Promise.all(promises);
  console.log('并发测试结果:', results);
}
concurrentTest();
```

---

**测试完成后，你应该能够：**
1. 🎯 验证优化版邮箱服务的性能提升
2. 🔄 确认服务切换功能正常工作
3. 📊 获得准确的性能对比数据
4. 🛡️ 验证系统的稳定性和可靠性

祝测试顺利！🎉
